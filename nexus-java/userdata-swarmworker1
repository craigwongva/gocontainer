sudo yum install docker â€“y

#yes this start/stop is necessary
sudo docker service start
sudo docker service stop

sudo docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock &

#not sure whether this usermod is necessary
sudo usermod -aG docker ec2-user













##
### Install Groovy.
####

cd /home/ec2-user > /tmp/userdata-nexus-swarmworker1-8300 2>&1
aws s3 cp s3://venicegeo-devops-dev-logstashforwarder-project/dotsdkman.zip . > /tmp/userdata-nexus-swarmworker1-8400 2>&1
unzip dotsdkman.zip > /tmp/userdata-nexus-swarmworker1-8500 2>&1

####
### Modify security groups that allow Manager to talk to Consul.
####

cd /home/ec2-user/gocontainer/nexus-java > /tmp/userdata-nexus-swarmworker1-8600 2>&1
cp /home/ec2-user/.sdkman/candidates/groovy/2.4.7/lib/groovy-2.4.7.jar . > /tmp/userdata-nexus-swarmworker1-8700 2>&1
cp /home/ec2-user/.sdkman/candidates/groovy/2.4.7/lib/groovy-json-2.4.7.jar . > /tmp/userdata-nexus-swarmworker1-8800 2>&1
/home/ec2-user/.sdkman/candidates/groovy/2.4.7/bin/groovyc modsecgrp_worker1.groovy > /tmp/userdata-nexus-worker1-8900 2>&1
java -cp .:./groovy-2.4.7.jar:./groovy-json-2.4.7.jar modsecgrp_worker1 option1 > /tmp/userdata-nexus-worker1-9000 2>&1

sudo docker run -d swarm join --advertise=`curl http://169.254.169.254/latest/meta-data/public-ipv4`:2375 consul://`/home/ec2-user/.sdkman/candidates/groovy/2.4.7/bin/groovyc modsecgrp_worker1.groovy option2`:8500 > /tmp/userdata-nexus-worker1-9100 2>&1
