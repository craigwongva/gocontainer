#invocation:
#
# replace-a-ubuntu-container <piazza service name>
# 
# where <piazza service name> is one of the following:
#  gateway
#  jobmanager
#  ingest
#  access
#  servicecontroller

myIP=`curl -s http://169.254.169.254/latest/meta-data/public-ipv4`
backingIP=$myIP
[ -z "$2" ] || backingIP=$2

echo myIP is $myIP
echo backingIP is $backingIP

if [ $1 == 'gateway' ]
then
 echo gateway myIP=$myIP
 sudo docker stop `sudo docker ps -a | grep gateway | cut -c1-6`
 sudo docker rm `sudo docker ps -a | grep gateway | cut -c1-6`
 sudo docker run -d -p 8081:8081 --add-host="pz-jobmanager.localdomain: $myIP" --add-host="pz-servicecontroller.localdomain:$myIP" --add-host="pz-access.localdomain:$myIP" venicegeodev/container_gateway
fi


if [ $1 == 'jobmanager' ]
then
 echo jobmanager backingIP=$backingIP
 sudo docker stop `sudo docker ps -a | grep jobmanager | cut -c1-6`
 sudo docker rm `sudo docker ps -a | grep jobmanager | cut -c1-6`
 sudo docker run -d -p 8083:8083 --add-host="jobdb.dev:$backingIP" --add-host="kafka.dev:$backingIP" venicegeodev/container_jobmanager
fi


if [ $1 == 'ingest' ]
then
 echo ingest backingIP=$backingIP
 sudo docker stop `sudo docker ps -a | grep ingest | cut -c1-6`
 sudo docker rm `sudo docker ps -a | grep ingest | cut -c1-6`
 sudo docker run -d -p 8084:8084 --add-host="jobdb.dev:$backingIP" --add-host="kafka.dev:$backingIP" venicegeodev/container_ingest
fi


if [ $1 == 'access' ]
then
 echo access backingIP=$backingIP
 sudo docker stop `sudo docker ps -a | grep access | cut -c1-6`
 sudo docker rm `sudo docker ps -a | grep access | cut -c1-6`
 sudo docker run -d -p 8085:8085 --add-host="jobdb.dev:$backingIP" --add-host="kafka.dev:$backingIP" venicegeodev/container_access
fi


if [ $1 == 'servicecontroller' ]
then
 echo servicecontroller backingIP=$backingIP
 sudo docker stop `sudo docker ps -a | grep servicecontroller | cut -c1-6`
 sudo docker rm `sudo docker ps -a | grep servicecontroller | cut -c1-6`
 sudo docker run -d -p 8088:8088 --add-host="jobdb.dev:$backingIP" --add-host="kafka.dev:$backingIP" venicegeodev/container_servicecontroller
fi


