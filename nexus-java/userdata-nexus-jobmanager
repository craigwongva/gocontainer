#sudo yum install docker -y > /tmp/userdata-nexus-jobmanager-6100 2>&1
#sudo service docker start > /tmp/userdata-nexus-jobmanager-6200 2>&1

#The following is necessary if working interactively as ec2-user:
# sudo usermod -a -G docker ec2-user

cd /home/ec2-user/gocontainer/nexus-java > /tmp/userdata-nexus-jobmanager-6300 2>&1
#sudo cp Dockerfile-first_webapp Dockerfile #this starts 8080 for test purposes but isn't central to docker+nexus issue

sed -i -e '/CMD/d' Dockerfile-nexus-jobmanager
echo CMD [\"/usr/lib/jvm/java-1.8.0-openjdk/bin/java\", \"-Dlogger.protocol=http\", \"-Dlogger.port=`cat pz-logger-port-number`\", \"-jar\", \"piazza-jobmanager-0.1.0-NEXUSSED.jar\"] >> Dockerfile-nexus-jobmanager
sudo cp Dockerfile-nexus-jobmanager Dockerfile > /tmp/userdata-nexus-jobmanager-6400 2>&1

sudo docker build --build-arg WHEREISNEXUS=$1 -t venicegeodev/container_jobmanager . > /tmp/userdata-nexus-jobmanager-6500 2>&1
sudo docker login --username venicegeodev --password demo1024 > /tmp/userdata-nexus-jobmanager-6510 2>&1
sudo docker push venicegeodev/container_jobmanager > /tmp/userdata-nexus-jobmanager-6520 2>&1
sudo docker pull venicegeodev/container_jobmanager > /tmp/userdata-nexus-jobmanager-6530 2>&1

#sudo docker run -d -p 8083:8083 --add-host="jobdb.dev:$1" --add-host="kafka.dev:$1" venicegeodev/container_jobmanager > /tmp/userdata-nexus-jobmanager-6999 2>&1
sudo docker run -d --net="host" venicegeodev/container_jobmanager > /tmp/userdata-nexus-jobmanager-6999 2>&1
